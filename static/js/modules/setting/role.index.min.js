"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var RoleIndex =
/*#__PURE__*/
function () {
  function RoleIndex() {
    _classCallCheck(this, RoleIndex);

    this.table = new TablePlugin("#tbRoles");
    this.alert = new AlertPlugin();
    this.ajax = new AjaxPlugin();
    this.form = new FormPlugin();
    this.$modalCreate = new ModalPlugin("#md-manage-create");
    this.$modalUpdate = new ModalPlugin("#md-manage-update");
    this.config = $.extend(true, {}, APP);
    this.url = {
      list: "".concat(this.config.url.controllerFullUrl, "/list"),
      update: "".concat(this.config.url.controllerFullUrl, "/update"),
      create: "".concat(this.config.url.controllerFullUrl, "/create"),
      permissions: "".concat(this.config.url.controllerFullUrl, "/permissions"),
      "delete": "".concat(this.config.url.controllerFullUrl, "/delete")
    };
  }

  _createClass(RoleIndex, [{
    key: "_submitCreate",
    value: function _submitCreate(form) {
      var _this = this;

      this.ajax.post(this.url.create, $(form).serialize()).then(function (result) {
        _this.table.refresh();

        _this.$modalCreate.close();

        Notify("success", result.data.message, "bottomRight");
      })["catch"](function (error) {
        Notify("error", error.data.message, "bottomRight");
      });
    }
  }, {
    key: "_submitUpdate",
    value: function _submitUpdate(form) {
      var _this2 = this;

      this.ajax.post(this.url.update, $(form).serialize()).then(function (result) {
        _this2.table.refresh();

        _this2.$modalUpdate.close();

        Notify("success", result.data.message, "bottomRight");
      })["catch"](function (error) {
        Notify("error", error.data.message, "bottomRight");
      });
    }
  }, {
    key: "_deleteRole",
    value: function _deleteRole(row) {
      var _this3 = this;

      var role = row.rname;
      this.alert.confirm({
        title: "¡Advertencia!",
        text: "\xBFEst\xE1 seguro de eliminar el rol <strong>\"".concat(role, "\".</strong>?"),
        type: "warning"
      }, function () {
        _this3.ajax.post(_this3.url["delete"], _this3.form.create({
          id: row.rid
        })).then(function (response) {
          _this3.table.refresh();

          Notify("success", response.data.message, "bottomRight");
        })["catch"](function (error) {
          Notify("error", error.data.message, "bottomRight");
        });
      });
    }
  }, {
    key: "initModalCreate",
    value: function initModalCreate() {
      var _this4 = this;

      this.$modalCreate.setOptions({
        title: 'Nuevo Registro',
        buttonInit: "#btn-create",
        form: "#form-manage-create",
        buttonCancel: '#btn-close',
        buttonSubmit: '#btn-save',
        formValidate: {
          rules: {
            "Role[rid]": {
              required: true
            },
            "Role[rname]": {
              required: true
            },
            "Role[rslug]": {
              required: true
            }
          }
        },
        onBeforeShow: function onBeforeShow() {}
      });
      this.$modalCreate.init();
      this.$modalCreate.submit(function (form) {
        _this4._submitCreate(form);
      });
    }
  }, {
    key: "initModalUpdate",
    value: function initModalUpdate() {
      var _this5 = this;

      this.$modalUpdate.setOptions({
        title: 'Actualizar Registro',
        form: "#form-manage-update",
        buttonInit: false,
        buttonCancel: '#btn-close',
        buttonSubmit: '#btn-save',
        formValidate: {
          rules: {
            "Role[rid]": {
              required: true
            },
            "Role[rname]": {
              required: true
            },
            "Role[rslug]": {
              required: true
            }
          }
        }
      });
      this.$modalUpdate.init();
      this.$modalUpdate.submit(function (form) {
        _this5._submitUpdate(form);
      });
    }
  }, {
    key: "initTable",
    value: function initTable() {
      var _this6 = this;

      this.table.setOptions({
        url: this.url.list,
        pageSize: 10
      });
      this.table.columns([{
        field: 'rid',
        title: 'ID',
        sortable: true,
        align: 'center',
        width: '70px'
      }, {
        field: 'rname',
        title: 'Nombre del Rol',
        sortable: true
      }, {
        field: 'rslug',
        title: 'Slug del Rol',
        sortable: true
      }, {
        field: 'rdescription',
        title: 'Descripción del Rol',
        sortable: true
      }, {
        field: 'action',
        title: '<i class="fa fa-ellipsis-h" aria-hidden="true"></i>',
        align: 'center',
        width: '70px',
        formatter: function formatter(value, row, index, field) {
          var actions = "";

          if (!row.rdefault) {
            actions = "\n          <div class=\"wrapper text-center\" role=\"toolbar\">\n            <div class=\"btn-group btn-group-sm\" role=\"group\">\n              <button \n                type=\"button\" \n                class=\"edit btn btn-outline-info\" \n                data-action=\"modify\" \n                data-rel=\"tooltip\" \n                title=\"Editar\">\n                <i class=\"fa fa-pencil\" aria-hidden=\"true\"></i>\n              </button>\n              <a \n                href=\"".concat(_this6.url.permissions, "?rid=").concat(row.rid, "\" \n                class=\"btn btn-outline-info\"\n                data-action=\"modify\" \n                data-rel=\"tooltip\" \n                title=\"Permisos\">\n                <i class=\"fa fa-cogs\" aria-hidden=\"true\"></i>\n              </a>\n              <button \n                type=\"button\" \n                class=\"delete btn btn-outline-danger\" \n                data-rel=\"tooltip\" \n                title=\"Editar\">\n                <i class=\"fa fa-trash\" aria-hidden=\"true\"></i>\n              </button>\n            </div>\n          </div>\n          ");
          }

          return actions;
        },
        events: {
          'click .edit': function clickEdit(e, value, row, index) {
            _this6.$modalUpdate.setData(row);

            _this6.$modalUpdate.open();
          },
          'click .delete': function clickDelete(e, value, row, index) {
            _this6._deleteRole(row);
          }
        }
      }]);
      this.table.init();
    }
  }, {
    key: "init",
    value: function init() {
      this.initTable();
      this.initModalCreate();
      this.initModalUpdate();
    }
  }]);

  return RoleIndex;
}();

$(function () {
  new RoleIndex().init();
});